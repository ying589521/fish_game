function Bullet(t,n){Sprite.call(this,t),this.sx=BULLET_SIZE[n].sx,this.sy=BULLET_SIZE[n].sy,this.w=BULLET_SIZE[n].w,this.h=BULLET_SIZE[n].h,this.iSpeed=6}function Cannon(t,n){Sprite.call(this,t["cannon"+n]),this.w=CANNON_SIZE[n].w,this.h=CANNON_SIZE[n].h,this.type=n}function loadImage(t,n,i){var h=0,s=0,e={};for(var o in t){s++;var r=new Image;r.src="img/"+t[o],e[o]=r,r.onload=function(){h++,i&&i(h,s),h==s&&n&&n(e)}}}function d2a(t){return t*Math.PI/180}function a2d(t){return 180*t/Math.PI}function rnd(t,n){return Math.floor(Math.random()*(n-t)+t)}function DieFish(t,n){Sprite.call(this,t["fish"+n]),this.w=FISH_SIZE[n].w,this.h=FISH_SIZE[n].h,this.iSpeed=0,this.sx=4*this.w,this.status=0}function Fish(t,n){Sprite.call(this,t["fish"+n]),this.w=FISH_SIZE[n].w,this.h=FISH_SIZE[n].h,this.iSpeed=3,this.type=n}function init(){var t=document.getElementById("c1"),n=t.getContext("2d");loadImage(sources,function(i){var h=new Sprite(i.bottom);h.w=765,h.h=71,h.x=t.width/2,h.y=t.height-h.h/2;var s=new Cannon(i,1);s.x=h.x+s.w/2+5,s.y=h.y;var e=[];setInterval(function(){var n=new Fish(i,rnd(1,6));n.x=-50,n.y=rnd(0,t.height),n.r=rnd(45,135),e.push(n)},500),t.onmousemove=function(n){var i=n.pageX-t.offsetLeft-s.x,h=s.y-(n.pageY-t.offsetTop);s.r=a2d(Math.atan2(i,h))};var o=[];t.onclick=function(){var t=new Audio;t.src="mp3/gunShot.mp3",t.play();var n=new Bullet(i.bullet,s.type);n.x=s.x,n.y=s.y,n.r=s.r,o.push(n)};var r=[];setInterval(function(){n.clearRect(0,0,t.width,t.height),h.draw(n);for(var a=0;a<e.length;a++)e[a].move(),e[a].draw(n);for(var a=0;a<o.length;a++)o[a].move(),o[a].draw(n);for(var a=0;a<o.length;a++)(o[a].x<-100||o[a].x>t.width+100||o[a].y<-100||o[a].y>t.height+100)&&(o.splice(a,1),a--);for(var a=0;a<e.length;a++)(e[a].x<-100||e[a].x>t.width+100||e[a].y<-100||e[a].y>t.height+100)&&(e.splice(a,1),a--);for(var a=0;a<r.length;a++)r[a].draw(n);for(var a=0;a<e.length;a++)for(var p=0;p<o.length;p++)if(o[p].collTest(e[a])){o.splice(p,1);var c=new DieFish(i,e[a].type);c.x=e[a].x,c.y=e[a].y,c.r=e[a].r,r.push(c),e.splice(a,1),p--,a--}s.draw(n)},30),setInterval(function(){for(var t=0;t<e.length;t++)e[t].swim();for(var t=0;t<r.length;t++)r[t].goDie(),1==r[t].status&&(r.splice(t,1),t--)},150)})}function Sprite(t){this.img=t,this.sx=0,this.sy=0,this.x=0,this.y=0,this.w=0,this.h=0,this.r=0,this.iSpeed=0}var BULLET_SIZE=[null,{sx:86,sy:0,w:24,h:26},{sx:61,sy:0,w:25,h:29},{sx:32,sy:35,w:27,h:31},{sx:30,sy:82,w:29,h:33},{sx:0,sy:82,w:30,h:34},{sx:30,sy:0,w:31,h:35},{sx:0,sy:44,w:32,h:38}];Bullet.prototype=new Sprite,Bullet.prototype.constructor=Bullet;var CANNON_SIZE=[null,{w:74,h:74},{w:74,h:76},{w:74,h:76},{w:74,h:83},{w:74,h:85},{w:74,h:90},{w:74,h:94}];Cannon.prototype=new Sprite,DieFish.prototype=new Sprite,DieFish.prototype.constructor=DieFish,DieFish.prototype.goDie=function(){this.sx+=this.w,this.sx==8*this.w&&(this.sx=4*this.w,this.status=1)};var FISH_SIZE=[null,{w:37,h:55},{w:64,h:78},{w:56,h:72},{w:59,h:77},{w:122,h:107}];Fish.prototype=new Sprite,Fish.prototype.constructor=Fish,Fish.prototype.swim=function(){this.sx+=this.w,this.sx%=4*this.w};var sources={bottom:"bottom.png",bullet:"bullet.png",cannon1:"cannon1.png",cannon2:"cannon2.png",cannon3:"cannon3.png",cannon4:"cannon4.png",cannon5:"cannon5.png",cannon6:"cannon6.png",cannon7:"cannon7.png",fish1:"fish1.png",fish2:"fish2.png",fish3:"fish3.png",fish4:"fish4.png",fish5:"fish5.png"};Sprite.prototype.draw=function(t){t.save(),t.beginPath(),t.translate(this.x,this.y),t.rotate(d2a(this.r)),t.drawImage(this.img,this.sx,this.sy,this.w,this.h,-this.w/2,-this.h/2,this.w,this.h),t.restore()},Sprite.prototype.collTest=function(t){var n=t.x-this.x,i=t.y-this.y,h=Math.sqrt(n*n+i*i);return h<30},Sprite.prototype.move=function(){var t=Math.sin(d2a(this.r))*this.iSpeed,n=-Math.cos(d2a(this.r))*this.iSpeed;this.x+=t,this.y+=n};